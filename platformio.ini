; ============================================================================
; PICKLE RICK - WiFi Security Tool for LILYGO T-LoraPager (K257)
; Inspired by M5PORKCHOP - Rebranded with Rick & Morty Space Theme
; AVERROES Tech Manufacturing
; ============================================================================

[platformio]
default_envs = pickle_rick
src_dir = src
boards_dir = boards

[env:pickle_rick]
platform = espressif32@6.10.0
board = lilygo-t-lora-pager
framework = arduino
upload_speed = 115200
monitor_speed = 115200
monitor_port = /dev/cu.usbmodem*

; Custom board variant location
board_build.variants_dir = variants

; 16MB Flash partition scheme
board_build.partitions = partitions_16MB.csv
board_build.filesystem = fatfs

; PSRAM enabled (8MB)
board_build.arduino.memory_type = qio_opi

build_flags =
    -DCORE_DEBUG_LEVEL=3
    -DARDUINO_T_LORA_PAGER
    -DARDUINO_LILYGO_LORA_SX1262
    -DBOARD_HAS_PSRAM
    -DARDUINO_USB_CDC_ON_BOOT=1

    ; NFC disabled - do NOT define USING_ST25R3916 at all
    ; (defining it as 0 still triggers #ifdef guards)
    -DDISABLE_NFC=1

    ; Pickle Rick Version
    -DPICKLE_RICK_VERSION=\"1.0.0\"
    -DPICKLE_RICK_CODENAME=\"WUBBA_LUBBA\"

    ; WiFi promiscuous mode
    -DCONFIG_ESP32_WIFI_AMPDU_TX_ENABLED=0
    -DCONFIG_ESP32_WIFI_AMPDU_RX_ENABLED=0

    ; BLE configuration
    -DCONFIG_BT_NIMBLE_ENABLED=1
    -DCONFIG_BT_NIMBLE_LOG_LEVEL=0

    ; LVGL configuration
    -DLV_CONF_INCLUDE_SIMPLE
    -DLV_USE_PRIVATE_API
    -DLV_FONT_MONTSERRAT_12=1
    -DLV_FONT_MONTSERRAT_16=1
    -DLV_FONT_MONTSERRAT_20=1

    ; SD Card SPI pins for K257
    -DBOARD_SPI_SS=5
    -DBOARD_SPI_MOSI=6
    -DBOARD_SPI_MISO=3
    -DBOARD_SPI_SCK=4

    ; Display pins
    -DDISPLAY_WIDTH=240
    -DDISPLAY_HEIGHT=320

    -Wnarrowing
    -I variants/k257_pager
    -I src

monitor_filters =
    default
    esp32_exception_decoder

lib_deps =
    ; GPS library
    mikalhart/TinyGPSPlus @ ^1.0.3

    ; BLE - NimBLE for BLE spam features
    h2zero/NimBLE-Arduino @ ^2.0.0

    ; JSON parsing
    bblanchon/ArduinoJson @ ^7.0.0

    ; Keyboard controller
    adafruit/Adafruit TCA8418 @ ^1.0.2
    adafruit/Adafruit BusIO @ ^1.17.0

    ; LoRa for mesh networking
    jgromes/RadioLib @ ^7.1.0

    ; Display - TFT_eSPI
    bodmer/TFT_eSPI @ ^2.5.43

; Upload settings for K257
upload_protocol = esptool
upload_flags =
    --before=default_reset
    --after=hard_reset
    --no-stub

; Debug build variant
[env:pickle_rick_debug]
extends = env:pickle_rick
build_type = debug
build_flags =
    ${env:pickle_rick.build_flags}
    -DCORE_DEBUG_LEVEL=5
    -DDEBUG_MODE=1
    -DPICKLE_RICK_DEBUG=1
